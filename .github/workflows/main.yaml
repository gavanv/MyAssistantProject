name: My Assistant CD Run
run-name: My assistant CD Run
on:
    push:
        branches:
            - main
        paths:
            - "!*"
            - "my_assistant/**"
            - ".github/workflows/main.yaml"
permissions:
    id-token: write
    contents: read
    pull-requests: write

defaults:
    run:
        working-directory: .

jobs:
    build_and_run_my_assistant_service:
        runs-on: ubuntu-latest
        # strategy:
        #     matrix:
        #         env: ["dev"]
        # environment: ${{ matrix.env }}

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Login to Docker Hub
              uses: docker/login-action@v2
              with:
                username: gavan777
                password: dckr_pat_1FyJzUyWEI-lJ0WYGyEgzr6FOGc

            - name: Build & Push Container Image
              shell: bash
              run: |
                  docker image build -t "gavan777/my-assistant:${{ github.sha }}" .
                  docker image push "gavan777/my-assistant:${{ github.sha }}"
                  docker -H 44.214.99.189 run \
                    -e MY_SQL_HOST="${{ secrets.MY_SQL_HOST }}"\
                    -e MY_SQL_USER="${{ secrets.MY_SQL_USER }}"\
                    -e MY_SQL_PASSWORD="${{ secrets.MY_SQL_PASSWORD }}"\
                    -e MY_SQL_DB_NAME="${{ secrets.MY_SQL_DB_NAME }}"\
                    -e MY_SQL_PORT="${{ secrets.MY_SQL_PORT }}"\
                    -e TOKEN="${{ secrets.TOKEN }}"\
                    -e GAVAN_USER_ID="${{ secrets.GAVAN_USER_ID }}"\
                    -d "gavan777/my-assistant:${{ github.sha }}"

